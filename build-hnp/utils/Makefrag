# use tic etc from homebrew
export PATH := /opt/homebrew/opt/ncurses/bin/:/opt/homebrew/opt/coreutils/libexec/gnubin:/opt/homebrew/opt/gnu-sed/libexec/gnubin:/opt/homebrew/opt/make/libexec/gnubin:$(PATH)
# avoid sed error
export LC_TYPE := C
# avoid probing unwanted packages
export PKG_CONFIG := /usr/bin/false
# set toolchain paths
export CC := $(OHOS_SDK_HOME)/native/llvm/bin/aarch64-unknown-linux-ohos-clang
export CXX := $(OHOS_SDK_HOME)/native/llvm/bin/aarch64-unknown-linux-ohos-clang++
export LD := $(OHOS_SDK_HOME)/native/llvm/bin/ld.lld
export AR := $(OHOS_SDK_HOME)/native/llvm/bin/llvm-ar
export RANLIB := $(OHOS_SDK_HOME)/native/llvm/bin/llvm-ranlib
export OBJCOPY := $(OHOS_SDK_HOME)/native/llvm/bin/llvm-objcopy
export OBJDUMP := $(OHOS_SDK_HOME)/native/llvm/bin/llvm-objdump
export READELF := $(OHOS_SDK_HOME)/native/llvm/bin/llvm-readelf
export STRIP := $(OHOS_SDK_HOME)/native/llvm/bin/llvm-strip
export CFLAGS := -I$(shell pwd)/../sysroot/include -Wno-int-conversion -O2
export CXXFLAGS := -I$(shell pwd)/../sysroot/include -O2
export LDFLAGS := -L$(shell pwd)/../sysroot/lib
export PREFIX := /data/app/base.org/base_1.0

define define_autotools_package
all: download/$(SOURCE_FILE)
	rm -rf temp build
	mkdir -p temp build
	cd temp && tar xvf ../download/$(SOURCE_FILE)
	cd temp/$(SOURCE_DIR) && mkdir build
	cd temp/$(SOURCE_DIR)/build && ../configure $(CONFIG_ARGS)
	cd temp/$(SOURCE_DIR)/build && make -j $(shell nproc)
	cd temp/$(SOURCE_DIR)/build && make install DESTDIR=$(shell pwd)/build
	mkdir -p ../sysroot
	rm -v build$(PREFIX)/lib/*.la
	cp -rfv build$(PREFIX)/. ../sysroot | tee file.lst

download/$(SOURCE_FILE):
	mkdir -p download
	cd download && wget $(SOURCE_URL)
endef
